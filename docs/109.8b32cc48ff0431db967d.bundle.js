(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{369:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var normalData,three_module=__webpack_require__(718),stats_min=__webpack_require__(719),dat_gui_module=__webpack_require__(720),MD2Loader=function(manager){three_module.Loader.call(this,manager)};MD2Loader.prototype=Object.assign(Object.create(three_module.Loader.prototype),{constructor:MD2Loader,load:function(url,onLoad,onProgress,onError){var scope=this,loader=new three_module.FileLoader(scope.manager);loader.setPath(scope.path),loader.setResponseType("arraybuffer"),loader.load(url,(function(buffer){onLoad(scope.parse(buffer))}),onProgress,onError)},parse:(normalData=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(buffer){console.time("MD2Loader");for(var data=new DataView(buffer),header={},headerNames=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],i=0;i<headerNames.length;i++)header[headerNames[i]]=data.getInt32(4*i,!0);if(844121161===header.ident&&8===header.version){if(header.offset_end===data.byteLength){for(var geometry=new three_module.BufferGeometry,uvsTemp=[],offset=header.offset_st,l=(i=0,header.num_st);i<l;i++){var u=data.getInt16(offset+0,!0),v=data.getInt16(offset+2,!0);uvsTemp.push(u/header.skinwidth,1-v/header.skinheight),offset+=4}offset=header.offset_tris;var vertexIndices=[],uvIndices=[];for(i=0,l=header.num_tris;i<l;i++)vertexIndices.push(data.getUint16(offset+0,!0),data.getUint16(offset+2,!0),data.getUint16(offset+4,!0)),uvIndices.push(data.getUint16(offset+6,!0),data.getUint16(offset+8,!0),data.getUint16(offset+10,!0)),offset+=12;var translation=new three_module.Vector3,scale=new three_module.Vector3,string=[],frames=[];for(offset=header.offset_frames,i=0,l=header.num_frames;i<l;i++){scale.set(data.getFloat32(offset+0,!0),data.getFloat32(offset+4,!0),data.getFloat32(offset+8,!0)),translation.set(data.getFloat32(offset+12,!0),data.getFloat32(offset+16,!0),data.getFloat32(offset+20,!0)),offset+=24;for(var j=0;j<16;j++){var character=data.getUint8(offset+j,!0);if(0===character)break;string[j]=character}var frame={name:String.fromCharCode.apply(null,string),vertices:[],normals:[]};for(offset+=16,j=0;j<header.num_vertices;j++){var x=data.getUint8(offset++,!0),y=data.getUint8(offset++,!0),z=data.getUint8(offset++,!0),n=normalData[data.getUint8(offset++,!0)];x=x*scale.x+translation.x,y=y*scale.y+translation.y,z=z*scale.z+translation.z,frame.vertices.push(x,z,y),frame.normals.push(n[0],n[2],n[1])}frames.push(frame)}var positions=[],normals=[],uvs=[],verticesTemp=frames[0].vertices,normalsTemp=frames[0].normals;for(i=0,l=vertexIndices.length;i<l;i++){x=verticesTemp[stride=3*vertexIndices[i]],y=verticesTemp[stride+1],z=verticesTemp[stride+2],positions.push(x,y,z);var nx=normalsTemp[stride],ny=normalsTemp[stride+1],nz=normalsTemp[stride+2];normals.push(nx,ny,nz),u=uvsTemp[stride=2*uvIndices[i]],v=uvsTemp[stride+1],uvs.push(u,v)}geometry.addAttribute("position",new three_module.Float32BufferAttribute(positions,3)),geometry.addAttribute("normal",new three_module.Float32BufferAttribute(normals,3)),geometry.addAttribute("uv",new three_module.Float32BufferAttribute(uvs,2));var morphPositions=[],morphNormals=[];for(i=0,l=frames.length;i<l;i++){var attributeName=(frame=frames[i]).name;if(frame.vertices.length>0){positions=[],j=0;for(var jl=vertexIndices.length;j<jl;j++){var stride=3*vertexIndices[j];x=frame.vertices[stride],y=frame.vertices[stride+1],z=frame.vertices[stride+2],positions.push(x,y,z)}var positionAttribute=new three_module.Float32BufferAttribute(positions,3);positionAttribute.name=attributeName,morphPositions.push(positionAttribute)}if(frame.normals.length>0){for(normals=[],j=0,jl=vertexIndices.length;j<jl;j++)stride=3*vertexIndices[j],nx=frame.normals[stride],ny=frame.normals[stride+1],nz=frame.normals[stride+2],normals.push(nx,ny,nz);var normalAttribute=new three_module.Float32BufferAttribute(normals,3);normalAttribute.name=attributeName,morphNormals.push(normalAttribute)}}return geometry.morphAttributes.position=morphPositions,geometry.morphAttributes.normal=morphNormals,geometry.animations=three_module.AnimationClip.CreateClipsFromMorphTargetSequences(frames,10),console.timeEnd("MD2Loader"),geometry}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})});var MD2Character=function(){var scope=this;function loadTextures(baseUrl,textureUrls){for(var textureLoader=new three_module.TextureLoader,textures=[],i=0;i<textureUrls.length;i++)textures[i]=textureLoader.load(baseUrl+textureUrls[i],checkLoadingComplete),textures[i].mapping=three_module.UVMapping,textures[i].name=textureUrls[i];return textures}function createPart(geometry,skinMap){var materialWireframe=new three_module.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),materialTexture=new three_module.MeshLambertMaterial({color:16777215,wireframe:!1,map:skinMap,morphTargets:!0,morphNormals:!0}),mesh=new three_module.Mesh(geometry,materialTexture);return mesh.rotation.y=-Math.PI/2,mesh.castShadow=!0,mesh.receiveShadow=!0,mesh.materialTexture=materialTexture,mesh.materialWireframe=materialWireframe,mesh}function checkLoadingComplete(){scope.loadCounter-=1,0===scope.loadCounter&&scope.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new three_module.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(config){this.loadCounter=2*config.weapons.length+config.skins.length+1;for(var weaponsTextures=[],i=0;i<config.weapons.length;i++)weaponsTextures[i]=config.weapons[i][1];this.skinsBody=loadTextures(config.baseUrl+"skins/",config.skins),this.skinsWeapon=loadTextures(config.baseUrl+"skins/",weaponsTextures);var loader=new MD2Loader;loader.load(config.baseUrl+config.body,(function(geo){var boundingBox=new three_module.Box3;boundingBox.setFromBufferAttribute(geo.attributes.position),scope.root.position.y=-scope.scale*boundingBox.min.y;var mesh=createPart(geo,scope.skinsBody[0]);mesh.scale.set(scope.scale,scope.scale,scope.scale),scope.root.add(mesh),scope.meshBody=mesh,scope.meshBody.clipOffset=0,scope.activeAnimationClipName=mesh.geometry.animations[0].name,scope.mixer=new three_module.AnimationMixer(mesh),checkLoadingComplete()}));var generateCallback=function(index,name){return function(geo){var mesh=createPart(geo,scope.skinsWeapon[index]);mesh.scale.set(scope.scale,scope.scale,scope.scale),mesh.visible=!1,mesh.name=name,scope.root.add(mesh),scope.weapons[index]=mesh,scope.meshWeapon=mesh,checkLoadingComplete()}};for(i=0;i<config.weapons.length;i++)loader.load(config.baseUrl+config.weapons[i][0],generateCallback(i,config.weapons[i][0]))},this.setPlaybackRate=function(rate){this.mixer.timeScale=0!==rate?1/rate:0},this.setWireframe=function(wireframeEnabled){wireframeEnabled?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(index){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[index])},this.setWeapon=function(index){for(var i=0;i<this.weapons.length;i++)this.weapons[i].visible=!1;var activeWeapon=this.weapons[index];activeWeapon&&(activeWeapon.visible=!0,this.meshWeapon=activeWeapon,scope.syncWeaponAnimation())},this.setAnimation=function(clipName){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var action=this.mixer.clipAction(clipName,this.meshBody);action&&(this.meshBody.activeAction=action.play())}scope.activeClipName=clipName,scope.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var clipName=scope.activeClipName;if(scope.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var action=this.mixer.clipAction(clipName,this.meshWeapon);action&&(this.meshWeapon.activeAction=action.syncWith(this.meshBody.activeAction).play())}},this.update=function(delta){this.mixer&&this.mixer.update(delta)}};__webpack_exports__.default=function(){var VIEWPORT_W=window.innerWidth,VIEWPORT_H=window.innerHeight,scene=new three_module.Scene,camera=new three_module.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);camera.position.x=-50,camera.position.y=40,camera.position.z=60,camera.lookAt(new three_module.Vector3(0,25,0));var renderer=new three_module.WebGLRenderer;renderer.setClearColor(new three_module.Color(14540253)),renderer.setSize(VIEWPORT_W,VIEWPORT_H),renderer.shadowMap.enabled=!0;var spotLight=new three_module.SpotLight(16777215);spotLight.position.set(-50,70,60),spotLight.intensity=1,scene.add(spotLight),document.getElementById("WebGL-output").appendChild(renderer.domElement);var controls={animations:"crattack",playbackrate:10},gui=new dat_gui_module.a,clock=new three_module.Clock,character=new MD2Character;character.onLoadComplete=function(){var animations=character.meshBody.geometry.animations,animLabels=[];animations.forEach((function(anim){anim.name.match(/\d{3}f$/)||animLabels.push(anim.name)})),gui.add(controls,"animations",animLabels).onChange((function(){character.setAnimation(controls.animations)})),gui.add(controls,"playbackrate",1,20).step(1).onChange((function(){character.setPlaybackRate(controls.playbackrate)})),character.setAnimation(controls.animations),character.setPlaybackRate(controls.playbackrate)},character.loadParts({baseUrl:"./assets/",body:"ogro.md2",skins:["skin.jpg"],weapons:[]}),scene.add(character.root);var statsObj,stats=((statsObj=new stats_min).showPanel(0),statsObj.dom.style.position="absolute",statsObj.dom.style.left="0px",statsObj.dom.style.top="0px",document.getElementById("Stats-output").appendChild(statsObj.dom),statsObj);window.addEventListener("resize",(function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}),!1);var renderScene=function(){stats.update();var delta=clock.getDelta();character.update(delta),requestAnimationFrame(renderScene),renderer.render(scene,camera)};renderScene()}},719:function(module,exports,__webpack_require__){var f;module.exports=((f=function(){function e(a){return c.appendChild(a.dom),a}function u(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",(function(a){a.preventDefault(),u(++l%c.children.length)}),!1);var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));return u(0),{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function(){k=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();if(h.update(c-k,200),c>g+1e3&&(r.update(1e3*a/(c-g),100),g=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){k=this.end()},domElement:c,setMode:u}}).Panel=function(e,f,l){var c=1/0,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r,q.height=h,q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");return b.font="bold "+9*a+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=l,b.fillRect(0,0,r,h),b.fillStyle=f,b.fillText(e,t,v),b.fillRect(d,m,n,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d,m,n,p),{dom:q,update:function(h,w){c=Math.min(c,h),k=Math.max(k,h),b.fillStyle=l,b.globalAlpha=1,b.fillRect(0,0,r,m),b.fillStyle=f,b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v),b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p),b.fillRect(d+n-a,m,a,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d+n-a,m,a,g((1-h/w)*p))}}},f)}}]);
//# sourceMappingURL=109.8b32cc48ff0431db967d.bundle.js.map