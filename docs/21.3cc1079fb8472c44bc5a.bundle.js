(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{690:function(module,exports,__webpack_require__){var f;module.exports=((f=function(){function e(a){return c.appendChild(a.dom),a}function u(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",(function(a){a.preventDefault(),u(++l%c.children.length)}),!1);var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));return u(0),{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function(){k=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();if(h.update(c-k,200),c>g+1e3&&(r.update(1e3*a/(c-g),100),g=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){k=this.end()},domElement:c,setMode:u}}).Panel=function(e,f,l){var c=1/0,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r,q.height=h,q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");return b.font="bold "+9*a+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=l,b.fillRect(0,0,r,h),b.fillStyle=f,b.fillText(e,t,v),b.fillRect(d,m,n,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d,m,n,p),{dom:q,update:function(h,w){c=Math.min(c,h),k=Math.max(k,h),b.fillStyle=l,b.globalAlpha=1,b.fillRect(0,0,r,m),b.fillStyle=f,b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v),b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p),b.fillRect(d+n-a,m,a,p),b.fillStyle=l,b.globalAlpha=.9,b.fillRect(d+n-a,m,a,g((1-h/w)*p))}}},f)},705:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return TGALoader}));var _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(691),TGALoader=function(manager){this.manager=void 0!==manager?manager:_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.DefaultLoadingManager};TGALoader.prototype={constructor:TGALoader,load:function(url,onLoad,onProgress,onError){var scope=this,texture=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Texture,loader=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.FileLoader(this.manager);return loader.setResponseType("arraybuffer"),loader.setPath(this.path),loader.load(url,(function(buffer){texture.image=scope.parse(buffer),texture.needsUpdate=!0,void 0!==onLoad&&onLoad(texture)}),onProgress,onError),texture},parse:function(buffer){var TGA_TYPE_NO_DATA=0,TGA_TYPE_INDEXED=1,TGA_TYPE_RGB=2,TGA_TYPE_GREY=3,TGA_TYPE_RLE_INDEXED=9,TGA_TYPE_RLE_RGB=10,TGA_TYPE_RLE_GREY=11,TGA_ORIGIN_MASK=48,TGA_ORIGIN_SHIFT=4,TGA_ORIGIN_BL=0,TGA_ORIGIN_BR=1,TGA_ORIGIN_UL=2,TGA_ORIGIN_UR=3;buffer.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var content=new Uint8Array(buffer),offset=0,header={id_length:content[offset++],colormap_type:content[offset++],image_type:content[offset++],colormap_index:content[offset++]|content[offset++]<<8,colormap_length:content[offset++]|content[offset++]<<8,colormap_size:content[offset++],origin:[content[offset++]|content[offset++]<<8,content[offset++]|content[offset++]<<8],width:content[offset++]|content[offset++]<<8,height:content[offset++]|content[offset++]<<8,pixel_size:content[offset++],flags:content[offset++]};!function tgaCheckHeader(header){switch(header.image_type){case TGA_TYPE_INDEXED:case TGA_TYPE_RLE_INDEXED:(header.colormap_length>256||24!==header.colormap_size||1!==header.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case TGA_TYPE_RGB:case TGA_TYPE_GREY:case TGA_TYPE_RLE_RGB:case TGA_TYPE_RLE_GREY:header.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case TGA_TYPE_NO_DATA:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',header.image_type)}(header.width<=0||header.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==header.pixel_size&&16!==header.pixel_size&&24!==header.pixel_size&&32!==header.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',header.pixel_size)}(header),header.id_length+offset>buffer.length&&console.error("THREE.TGALoader: No data."),offset+=header.id_length;var use_rle=!1,use_pal=!1,use_grey=!1;switch(header.image_type){case TGA_TYPE_RLE_INDEXED:use_rle=!0,use_pal=!0;break;case TGA_TYPE_INDEXED:use_pal=!0;break;case TGA_TYPE_RLE_RGB:use_rle=!0;break;case TGA_TYPE_RGB:break;case TGA_TYPE_RLE_GREY:use_rle=!0,use_grey=!0;break;case TGA_TYPE_GREY:use_grey=!0}var useOffscreen="undefined"!=typeof OffscreenCanvas,canvas=useOffscreen?new OffscreenCanvas(header.width,header.height):document.createElement("canvas");canvas.width=header.width,canvas.height=header.height;var context=canvas.getContext("2d"),imageData=context.createImageData(header.width,header.height),result=function tgaParse(use_rle,use_pal,header,offset,data){var pixel_data,pixel_size,pixel_total,palettes;if(pixel_size=header.pixel_size>>3,pixel_total=header.width*header.height*pixel_size,use_pal&&(palettes=data.subarray(offset,offset+=header.colormap_length*(header.colormap_size>>3))),use_rle){var c,count,i;pixel_data=new Uint8Array(pixel_total);for(var shift=0,pixels=new Uint8Array(pixel_size);shift<pixel_total;)if(count=1+(127&(c=data[offset++])),128&c){for(i=0;i<pixel_size;++i)pixels[i]=data[offset++];for(i=0;i<count;++i)pixel_data.set(pixels,shift+i*pixel_size);shift+=pixel_size*count}else{for(count*=pixel_size,i=0;i<count;++i)pixel_data[shift+i]=data[offset++];shift+=count}}else pixel_data=data.subarray(offset,offset+=use_pal?header.width*header.height:pixel_total);return{pixel_data:pixel_data,palettes:palettes}}(use_rle,use_pal,header,offset,content);(function getTgaRGBA(data,width,height,image,palette){var x_start,y_start,x_step,y_step,x_end,y_end;switch((header.flags&TGA_ORIGIN_MASK)>>TGA_ORIGIN_SHIFT){default:case TGA_ORIGIN_UL:x_start=0,x_step=1,x_end=width,y_start=0,y_step=1,y_end=height;break;case TGA_ORIGIN_BL:x_start=0,x_step=1,x_end=width,y_start=height-1,y_step=-1,y_end=-1;break;case TGA_ORIGIN_UR:x_start=width-1,x_step=-1,x_end=-1,y_start=0,y_step=1,y_end=height;break;case TGA_ORIGIN_BR:x_start=width-1,x_step=-1,x_end=-1,y_start=height-1,y_step=-1,y_end=-1}if(use_grey)switch(header.pixel_size){case 8:!function tgaGetImageDataGrey8bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var color,x,y,i=0,width=header.width;for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i++)color=image[i],imageData[4*(x+width*y)+0]=color,imageData[4*(x+width*y)+1]=color,imageData[4*(x+width*y)+2]=color,imageData[4*(x+width*y)+3]=255;return imageData}(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;case 16:!function tgaGetImageDataGrey16bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var x,y,i=0,width=header.width;for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=2)imageData[4*(x+width*y)+0]=image[i+0],imageData[4*(x+width*y)+1]=image[i+0],imageData[4*(x+width*y)+2]=image[i+0],imageData[4*(x+width*y)+3]=image[i+1];return imageData}(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(header.pixel_size){case 8:!function tgaGetImageData8bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image,palettes){var color,x,y,colormap=palettes,i=0,width=header.width;for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i++)color=image[i],imageData[4*(x+width*y)+3]=255,imageData[4*(x+width*y)+2]=colormap[3*color+0],imageData[4*(x+width*y)+1]=colormap[3*color+1],imageData[4*(x+width*y)+0]=colormap[3*color+2];return imageData}(data,y_start,y_step,y_end,x_start,x_step,x_end,image,palette);break;case 16:!function tgaGetImageData16bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var color,x,y,i=0,width=header.width;for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=2)color=image[i+0]+(image[i+1]<<8),imageData[4*(x+width*y)+0]=(31744&color)>>7,imageData[4*(x+width*y)+1]=(992&color)>>2,imageData[4*(x+width*y)+2]=(31&color)>>3,imageData[4*(x+width*y)+3]=32768&color?0:255;return imageData}(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;case 24:!function tgaGetImageData24bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var x,y,i=0,width=header.width;for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=3)imageData[4*(x+width*y)+3]=255,imageData[4*(x+width*y)+2]=image[i+0],imageData[4*(x+width*y)+1]=image[i+1],imageData[4*(x+width*y)+0]=image[i+2];return imageData}(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;case 32:!function tgaGetImageData32bits(imageData,y_start,y_step,y_end,x_start,x_step,x_end,image){var x,y,i=0,width=header.width;for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=4)imageData[4*(x+width*y)+2]=image[i+0],imageData[4*(x+width*y)+1]=image[i+1],imageData[4*(x+width*y)+0]=image[i+2],imageData[4*(x+width*y)+3]=image[i+3];return imageData}(data,y_start,y_step,y_end,x_start,x_step,x_end,image);break;default:console.error("THREE.TGALoader: Format not supported.")}return data})(imageData.data,header.width,header.height,result.pixel_data,result.palettes);return context.putImageData(imageData,0,0),useOffscreen?canvas.transferToImageBitmap():canvas},setPath:function(value){return this.path=value,this}}},719:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ColladaLoader}));var _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(691),_loaders_TGALoader_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(705),ColladaLoader=function(manager){this.manager=void 0!==manager?manager:_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.DefaultLoadingManager};ColladaLoader.prototype={constructor:ColladaLoader,crossOrigin:"anonymous",load:function(url,onLoad,onProgress,onError){var scope=this,path=void 0===scope.path?_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.LoaderUtils.extractUrlBase(url):scope.path,loader=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.FileLoader(scope.manager);loader.setPath(scope.path),loader.load(url,(function(text){onLoad(scope.parse(text,path))}),onProgress,onError)},setPath:function(value){return this.path=value,this},setResourcePath:function(value){return this.resourcePath=value,this},options:{set convertUpAxis(value){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(value){return this.crossOrigin=value,this},parse:function(text,path){function getElementsByTagName(xml,name){for(var array=[],childNodes=xml.childNodes,i=0,l=childNodes.length;i<l;i++){var child=childNodes[i];child.nodeName===name&&array.push(child)}return array}function parseStrings(text){if(0===text.length)return[];for(var parts=text.trim().split(/\s+/),array=new Array(parts.length),i=0,l=parts.length;i<l;i++)array[i]=parts[i];return array}function parseFloats(text){if(0===text.length)return[];for(var parts=text.trim().split(/\s+/),array=new Array(parts.length),i=0,l=parts.length;i<l;i++)array[i]=parseFloat(parts[i]);return array}function parseInts(text){if(0===text.length)return[];for(var parts=text.trim().split(/\s+/),array=new Array(parts.length),i=0,l=parts.length;i<l;i++)array[i]=parseInt(parts[i]);return array}function parseId(text){return text.substring(1)}function isEmpty(object){return 0===Object.keys(object).length}function parseAssetUnit(xml){return void 0!==xml&&!0===xml.hasAttribute("meter")?parseFloat(xml.getAttribute("meter")):1}function parseAssetUpAxis(xml){return void 0!==xml?xml.textContent:"Y_UP"}function parseLibrary(xml,libraryName,nodeName,parser){var library=getElementsByTagName(xml,libraryName)[0];if(void 0!==library)for(var elements=getElementsByTagName(library,nodeName),i=0;i<elements.length;i++)parser(elements[i])}function buildLibrary(data,builder){for(var name in data){data[name].build=builder(data[name])}}function getBuild(data,builder){return void 0!==data.build?data.build:(data.build=builder(data),data.build)}function parseAnimationSampler(xml){for(var data={inputs:{}},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"input":var id=parseId(child.getAttribute("source")),semantic=child.getAttribute("semantic");data.inputs[semantic]=id}}return data}function parseAnimationChannel(xml){var data={},parts=xml.getAttribute("target").split("/"),id=parts.shift(),sid=parts.shift(),arraySyntax=-1!==sid.indexOf("("),memberSyntax=-1!==sid.indexOf(".");if(memberSyntax)parts=sid.split("."),sid=parts.shift(),data.member=parts.shift();else if(arraySyntax){var indices=sid.split("(");sid=indices.shift();for(var i=0;i<indices.length;i++)indices[i]=parseInt(indices[i].replace(/\)/,""));data.indices=indices}return data.id=id,data.sid=sid,data.arraySyntax=arraySyntax,data.memberSyntax=memberSyntax,data.sampler=parseId(xml.getAttribute("source")),data}function buildAnimation(data){var tracks=[],channels=data.channels,samplers=data.samplers,sources=data.sources;for(var target in channels)if(channels.hasOwnProperty(target)){var channel=channels[target],sampler=samplers[channel.sampler],inputId=sampler.inputs.INPUT,outputId=sampler.inputs.OUTPUT;createKeyframeTracks(buildAnimationChannel(channel,sources[inputId],sources[outputId]),tracks)}return tracks}function getAnimation(id){return getBuild(library.animations[id],buildAnimation)}function buildAnimationChannel(channel,inputSource,outputSource){var time,stride,i,il,j,jl,node=library.nodes[channel.id],object3D=getNode(node.id),transform=node.transforms[channel.sid],defaultMatrix=node.matrix.clone().transpose(),data={};switch(transform){case"matrix":for(i=0,il=inputSource.array.length;i<il;i++)if(time=inputSource.array[i],stride=i*outputSource.stride,void 0===data[time]&&(data[time]={}),!0===channel.arraySyntax){var value=outputSource.array[stride],index=channel.indices[0]+4*channel.indices[1];data[time][index]=value}else for(j=0,jl=outputSource.stride;j<jl;j++)data[time][j]=outputSource.array[stride+j];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',transform)}var keyframes=function prepareAnimationData(data,defaultMatrix){var keyframes=[];for(var time in data)keyframes.push({time:parseFloat(time),value:data[time]});keyframes.sort((function ascending(a,b){return a.time-b.time}));for(var i=0;i<16;i++)transformAnimationData(keyframes,i,defaultMatrix.elements[i]);return keyframes}(data,defaultMatrix);return{name:object3D.uuid,keyframes:keyframes}}var position=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3,scale=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3,quaternion=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Quaternion;function createKeyframeTracks(animation,tracks){for(var keyframes=animation.keyframes,name=animation.name,times=[],positionData=[],quaternionData=[],scaleData=[],i=0,l=keyframes.length;i<l;i++){var keyframe=keyframes[i],time=keyframe.time,value=keyframe.value;matrix.fromArray(value).transpose(),matrix.decompose(position,quaternion,scale),times.push(time),positionData.push(position.x,position.y,position.z),quaternionData.push(quaternion.x,quaternion.y,quaternion.z,quaternion.w),scaleData.push(scale.x,scale.y,scale.z)}return positionData.length>0&&tracks.push(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.VectorKeyframeTrack(name+".position",times,positionData)),quaternionData.length>0&&tracks.push(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.QuaternionKeyframeTrack(name+".quaternion",times,quaternionData)),scaleData.length>0&&tracks.push(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.VectorKeyframeTrack(name+".scale",times,scaleData)),tracks}function transformAnimationData(keyframes,property,defaultValue){var keyframe,i,l,empty=!0;for(i=0,l=keyframes.length;i<l;i++)void 0===(keyframe=keyframes[i]).value[property]?keyframe.value[property]=null:empty=!1;if(!0===empty)for(i=0,l=keyframes.length;i<l;i++)(keyframe=keyframes[i]).value[property]=defaultValue;else!function createMissingKeyframes(keyframes,property){for(var prev,next,i=0,l=keyframes.length;i<l;i++){var keyframe=keyframes[i];if(null===keyframe.value[property]){if(prev=getPrev(keyframes,i,property),next=getNext(keyframes,i,property),null===prev){keyframe.value[property]=next.value[property];continue}if(null===next){keyframe.value[property]=prev.value[property];continue}interpolate(keyframe,prev,next,property)}}}(keyframes,property)}function getPrev(keyframes,i,property){for(;i>=0;){var keyframe=keyframes[i];if(null!==keyframe.value[property])return keyframe;i--}return null}function getNext(keyframes,i,property){for(;i<keyframes.length;){var keyframe=keyframes[i];if(null!==keyframe.value[property])return keyframe;i++}return null}function interpolate(key,prev,next,property){next.time-prev.time!=0?key.value[property]=(key.time-prev.time)*(next.value[property]-prev.value[property])/(next.time-prev.time)+prev.value[property]:key.value[property]=prev.value[property]}function buildAnimationClip(data){for(var tracks=[],name=data.name,duration=data.end-data.start||-1,animations=data.animations,i=0,il=animations.length;i<il;i++)for(var animationTracks=getAnimation(animations[i]),j=0,jl=animationTracks.length;j<jl;j++)tracks.push(animationTracks[j]);return new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.AnimationClip(name,duration,tracks)}function getAnimationClip(id){return getBuild(library.clips[id],buildAnimationClip)}function parseSkin(xml){for(var data={sources:{}},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"bind_shape_matrix":data.bindShapeMatrix=parseFloats(child.textContent);break;case"source":var id=child.getAttribute("id");data.sources[id]=parseSource(child);break;case"joints":data.joints=parseJoints(child);break;case"vertex_weights":data.vertexWeights=parseVertexWeights(child)}}return data}function parseJoints(xml){for(var data={inputs:{}},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"input":var semantic=child.getAttribute("semantic"),id=parseId(child.getAttribute("source"));data.inputs[semantic]=id}}return data}function parseVertexWeights(xml){for(var data={inputs:{}},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"input":var semantic=child.getAttribute("semantic"),id=parseId(child.getAttribute("source")),offset=parseInt(child.getAttribute("offset"));data.inputs[semantic]={id:id,offset:offset};break;case"vcount":data.vcount=parseInts(child.textContent);break;case"v":data.v=parseInts(child.textContent)}}return data}function buildController(data){var build={id:data.id},geometry=library.geometries[build.id];return void 0!==data.skin&&(build.skin=function buildSkin(data){var i,j,l,build={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},sources=data.sources,vertexWeights=data.vertexWeights,vcount=vertexWeights.vcount,v=vertexWeights.v,jointOffset=vertexWeights.inputs.JOINT.offset,weightOffset=vertexWeights.inputs.WEIGHT.offset,jointSource=data.sources[data.joints.inputs.JOINT],inverseSource=data.sources[data.joints.inputs.INV_BIND_MATRIX],weights=sources[vertexWeights.inputs.WEIGHT.id].array,stride=0;for(i=0,l=vcount.length;i<l;i++){var jointCount=vcount[i],vertexSkinData=[];for(j=0;j<jointCount;j++){var skinIndex=v[stride+jointOffset],weightId=v[stride+weightOffset],skinWeight=weights[weightId];vertexSkinData.push({index:skinIndex,weight:skinWeight}),stride+=2}for(vertexSkinData.sort(descending),j=0;j<4;j++){var d=vertexSkinData[j];void 0!==d?(build.indices.array.push(d.index),build.weights.array.push(d.weight)):(build.indices.array.push(0),build.weights.array.push(0))}}data.bindShapeMatrix?build.bindMatrix=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4).fromArray(data.bindShapeMatrix).transpose():build.bindMatrix=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4).identity();for(i=0,l=jointSource.array.length;i<l;i++){var name=jointSource.array[i],boneInverse=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4).fromArray(inverseSource.array,i*inverseSource.stride).transpose();build.joints.push({name:name,boneInverse:boneInverse})}return build;function descending(a,b){return b.weight-a.weight}}(data.skin),geometry.sources.skinIndices=build.skin.indices,geometry.sources.skinWeights=build.skin.weights),build}function buildImage(data){return void 0!==data.build?data.build:data.init_from}function getImage(id){var data=library.images[id];return void 0!==data?getBuild(data,buildImage):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",id),null)}function parseEffectProfileCOMMON(xml){for(var data={surfaces:{},samplers:{}},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"newparam":parseEffectNewparam(child,data);break;case"technique":data.technique=parseEffectTechnique(child);break;case"extra":data.extra=parseEffectExtra(child)}}return data}function parseEffectNewparam(xml,data){for(var sid=xml.getAttribute("sid"),i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"surface":data.surfaces[sid]=parseEffectSurface(child);break;case"sampler2D":data.samplers[sid]=parseEffectSampler(child)}}}function parseEffectSurface(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"init_from":data.init_from=child.textContent}}return data}function parseEffectSampler(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"source":data.source=child.textContent}}return data}function parseEffectTechnique(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"constant":case"lambert":case"blinn":case"phong":data.type=child.nodeName,data.parameters=parseEffectParameters(child)}}return data}function parseEffectParameters(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":data[child.nodeName]=parseEffectParameter(child);break;case"transparent":data[child.nodeName]={opaque:child.getAttribute("opaque"),data:parseEffectParameter(child)}}}return data}function parseEffectParameter(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"color":data[child.nodeName]=parseFloats(child.textContent);break;case"float":data[child.nodeName]=parseFloat(child.textContent);break;case"texture":data[child.nodeName]={id:child.getAttribute("texture"),extra:parseEffectParameterTexture(child)}}}return data}function parseEffectParameterTexture(xml){for(var data={technique:{}},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"extra":parseEffectParameterTextureExtra(child,data)}}return data}function parseEffectParameterTextureExtra(xml,data){for(var i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"technique":parseEffectParameterTextureExtraTechnique(child,data)}}}function parseEffectParameterTextureExtraTechnique(xml,data){for(var i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":data.technique[child.nodeName]=parseFloat(child.textContent);break;case"wrapU":case"wrapV":"TRUE"===child.textContent.toUpperCase()?data.technique[child.nodeName]=1:"FALSE"===child.textContent.toUpperCase()?data.technique[child.nodeName]=0:data.technique[child.nodeName]=parseInt(child.textContent)}}}function parseEffectExtra(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"technique":data.technique=parseEffectExtraTechnique(child)}}return data}function parseEffectExtraTechnique(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"double_sided":data[child.nodeName]=parseInt(child.textContent)}}return data}function buildEffect(data){return data}function buildMaterial(data){var material,effect=function getEffect(id){return getBuild(library.effects[id],buildEffect)}(data.url),technique=effect.profile.technique,extra=effect.profile.extra;switch(technique.type){case"phong":case"blinn":material=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.MeshPhongMaterial;break;case"lambert":material=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.MeshLambertMaterial;break;default:material=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.MeshBasicMaterial}function getTexture(textureObject){var sampler=effect.profile.samplers[textureObject.id],image=null;void 0!==sampler?image=getImage(effect.profile.surfaces[sampler.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),image=getImage(textureObject.id));if(null!==image){var loader=function getTextureLoader(image){var loader,extension=image.slice(2+(image.lastIndexOf(".")-1>>>0));switch(extension=extension.toLowerCase()){case"tga":loader=tgaLoader;break;default:loader=textureLoader}return loader}(image);if(void 0!==loader){var texture=loader.load(image),extra=textureObject.extra;if(void 0!==extra&&void 0!==extra.technique&&!1===isEmpty(extra.technique)){var technique=extra.technique;texture.wrapS=technique.wrapU?_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.RepeatWrapping:_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.ClampToEdgeWrapping,texture.wrapT=technique.wrapV?_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.RepeatWrapping:_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.ClampToEdgeWrapping,texture.offset.set(technique.offsetU||0,technique.offsetV||0),texture.repeat.set(technique.repeatU||1,technique.repeatV||1)}else texture.wrapS=_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.RepeatWrapping,texture.wrapT=_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.RepeatWrapping;return texture}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",image),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",textureObject.id),null}material.name=data.name||"";var parameters=technique.parameters;for(var key in parameters){var parameter=parameters[key];switch(key){case"diffuse":parameter.color&&material.color.fromArray(parameter.color),parameter.texture&&(material.map=getTexture(parameter.texture));break;case"specular":parameter.color&&material.specular&&material.specular.fromArray(parameter.color),parameter.texture&&(material.specularMap=getTexture(parameter.texture));break;case"bump":parameter.texture&&(material.normalMap=getTexture(parameter.texture));break;case"ambient":parameter.texture&&(material.lightMap=getTexture(parameter.texture));break;case"shininess":parameter.float&&material.shininess&&(material.shininess=parameter.float);break;case"emission":parameter.color&&material.emissive&&material.emissive.fromArray(parameter.color),parameter.texture&&(material.emissiveMap=getTexture(parameter.texture))}}var transparent=parameters.transparent,transparency=parameters.transparency;if(void 0===transparency&&transparent&&(transparency={float:1}),void 0===transparent&&transparency&&(transparent={opaque:"A_ONE",data:{color:[1,1,1,1]}}),transparent&&transparency)if(transparent.data.texture)material.transparent=!0;else{var color=transparent.data.color;switch(transparent.opaque){case"A_ONE":material.opacity=color[3]*transparency.float;break;case"RGB_ZERO":material.opacity=1-color[0]*transparency.float;break;case"A_ZERO":material.opacity=1-color[3]*transparency.float;break;case"RGB_ONE":material.opacity=color[0]*transparency.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',transparent.opaque)}material.opacity<1&&(material.transparent=!0)}return void 0!==extra&&void 0!==extra.technique&&1===extra.technique.double_sided&&(material.side=_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.DoubleSide),material}function getMaterial(id){return getBuild(library.materials[id],buildMaterial)}function parseCameraOptics(xml){for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];switch(child.nodeName){case"technique_common":return parseCameraTechnique(child)}}return{}}function parseCameraTechnique(xml){for(var data={},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];switch(child.nodeName){case"perspective":case"orthographic":data.technique=child.nodeName,data.parameters=parseCameraParameters(child)}}return data}function parseCameraParameters(xml){for(var data={},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];switch(child.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":data[child.nodeName]=parseFloat(child.textContent)}}return data}function buildCamera(data){var camera;switch(data.optics.technique){case"perspective":camera=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.PerspectiveCamera(data.optics.parameters.yfov,data.optics.parameters.aspect_ratio,data.optics.parameters.znear,data.optics.parameters.zfar);break;case"orthographic":var ymag=data.optics.parameters.ymag,xmag=data.optics.parameters.xmag,aspectRatio=data.optics.parameters.aspect_ratio;xmag=void 0===xmag?ymag*aspectRatio:xmag,ymag=void 0===ymag?xmag/aspectRatio:ymag,xmag*=.5,ymag*=.5,camera=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.OrthographicCamera(-xmag,xmag,ymag,-ymag,data.optics.parameters.znear,data.optics.parameters.zfar);break;default:camera=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.PerspectiveCamera}return camera.name=data.name||"",camera}function getCamera(id){var data=library.cameras[id];return void 0!==data?getBuild(data,buildCamera):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",id),null)}function parseLightTechnique(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"directional":case"point":case"spot":case"ambient":data.technique=child.nodeName,data.parameters=parseLightParameters(child)}}return data}function parseLightParameters(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"color":var array=parseFloats(child.textContent);data.color=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Color).fromArray(array);break;case"falloff_angle":data.falloffAngle=parseFloat(child.textContent);break;case"quadratic_attenuation":var f=parseFloat(child.textContent);data.distance=f?Math.sqrt(1/f):0}}return data}function buildLight(data){var light;switch(data.technique){case"directional":light=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.DirectionalLight;break;case"point":light=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.PointLight;break;case"spot":light=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.SpotLight;break;case"ambient":light=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.AmbientLight}return data.parameters.color&&light.color.copy(data.parameters.color),data.parameters.distance&&(light.distance=data.parameters.distance),light}function getLight(id){var data=library.lights[id];return void 0!==data?getBuild(data,buildLight):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",id),null)}function parseSource(xml){for(var data={array:[],stride:3},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"float_array":data.array=parseFloats(child.textContent);break;case"Name_array":data.array=parseStrings(child.textContent);break;case"technique_common":var accessor=getElementsByTagName(child,"accessor")[0];void 0!==accessor&&(data.stride=parseInt(accessor.getAttribute("stride")))}}return data}function parseGeometryVertices(xml){for(var data={},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];1===child.nodeType&&(data[child.getAttribute("semantic")]=parseId(child.getAttribute("source")))}return data}function parseGeometryPrimitive(xml){for(var primitive={type:xml.nodeName,material:xml.getAttribute("material"),count:parseInt(xml.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"input":var id=parseId(child.getAttribute("source")),semantic=child.getAttribute("semantic"),offset=parseInt(child.getAttribute("offset")),set=parseInt(child.getAttribute("set")),inputname=set>0?semantic+set:semantic;primitive.inputs[inputname]={id:id,offset:offset},primitive.stride=Math.max(primitive.stride,offset+1),"TEXCOORD"===semantic&&(primitive.hasUV=!0);break;case"vcount":primitive.vcount=parseInts(child.textContent);break;case"p":primitive.p=parseInts(child.textContent)}}return primitive}function checkUVCoordinates(primitives){for(var count=0,i=0,l=primitives.length;i<l;i++){!0===primitives[i].hasUV&&count++}count>0&&count<primitives.length&&(primitives.uvsNeedsFix=!0)}function buildGeometry(data){var build={},sources=data.sources,vertices=data.vertices,primitives=data.primitives;if(0===primitives.length)return{};var groupedPrimitives=function groupPrimitives(primitives){for(var build={},i=0;i<primitives.length;i++){var primitive=primitives[i];void 0===build[primitive.type]&&(build[primitive.type]=[]),build[primitive.type].push(primitive)}return build}(primitives);for(var type in groupedPrimitives){var primitiveType=groupedPrimitives[type];checkUVCoordinates(primitiveType),build[type]=buildGeometryType(primitiveType,sources,vertices)}return build}function buildGeometryType(primitives,sources,vertices){for(var build={},position={array:[],stride:0},normal={array:[],stride:0},uv={array:[],stride:0},uv2={array:[],stride:0},color={array:[],stride:0},skinIndex_array=[],skinIndex_stride=4,skinWeight_array=[],skinWeight_stride=4,geometry=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.BufferGeometry,materialKeys=[],start=0,p=0;p<primitives.length;p++){var primitive=primitives[p],inputs=primitive.inputs,count=0;switch(primitive.type){case"lines":case"linestrips":count=2*primitive.count;break;case"triangles":count=3*primitive.count;break;case"polylist":for(var g=0;g<primitive.count;g++){var vc=primitive.vcount[g];switch(vc){case 3:count+=3;break;case 4:count+=6;break;default:count+=3*(vc-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",primitive.type)}for(var name in geometry.addGroup(start,count,p),start+=count,primitive.material&&materialKeys.push(primitive.material),inputs){var input=inputs[name];switch(name){case"VERTEX":for(var key in vertices){var id=vertices[key];switch(key){case"POSITION":var prevLength=position.array.length;if(buildGeometryData(primitive,sources[id],input.offset,position.array),position.stride=sources[id].stride,sources.skinWeights&&sources.skinIndices&&(buildGeometryData(primitive,sources.skinIndices,input.offset,skinIndex_array),buildGeometryData(primitive,sources.skinWeights,input.offset,skinWeight_array)),!1===primitive.hasUV&&!0===primitives.uvsNeedsFix){count=(position.array.length-prevLength)/position.stride;for(var i=0;i<count;i++)uv.array.push(0,0)}break;case"NORMAL":buildGeometryData(primitive,sources[id],input.offset,normal.array),normal.stride=sources[id].stride;break;case"COLOR":buildGeometryData(primitive,sources[id],input.offset,color.array),color.stride=sources[id].stride;break;case"TEXCOORD":buildGeometryData(primitive,sources[id],input.offset,uv.array),uv.stride=sources[id].stride;break;case"TEXCOORD1":buildGeometryData(primitive,sources[id],input.offset,uv2.array),uv.stride=sources[id].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',key)}}break;case"NORMAL":buildGeometryData(primitive,sources[input.id],input.offset,normal.array),normal.stride=sources[input.id].stride;break;case"COLOR":buildGeometryData(primitive,sources[input.id],input.offset,color.array),color.stride=sources[input.id].stride;break;case"TEXCOORD":buildGeometryData(primitive,sources[input.id],input.offset,uv.array),uv.stride=sources[input.id].stride;break;case"TEXCOORD1":buildGeometryData(primitive,sources[input.id],input.offset,uv2.array),uv2.stride=sources[input.id].stride}}}return position.array.length>0&&geometry.addAttribute("position",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(position.array,position.stride)),normal.array.length>0&&geometry.addAttribute("normal",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(normal.array,normal.stride)),color.array.length>0&&geometry.addAttribute("color",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(color.array,color.stride)),uv.array.length>0&&geometry.addAttribute("uv",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(uv.array,uv.stride)),uv2.array.length>0&&geometry.addAttribute("uv2",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(uv2.array,uv2.stride)),skinIndex_array.length>0&&geometry.addAttribute("skinIndex",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(skinIndex_array,skinIndex_stride)),skinWeight_array.length>0&&geometry.addAttribute("skinWeight",new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Float32BufferAttribute(skinWeight_array,skinWeight_stride)),build.data=geometry,build.type=primitives[0].type,build.materialKeys=materialKeys,build}function buildGeometryData(primitive,source,offset,array){var indices=primitive.p,stride=primitive.stride,vcount=primitive.vcount;function pushVector(i){for(var index=indices[i+offset]*sourceStride,length=index+sourceStride;index<length;index++)array.push(sourceArray[index])}var sourceArray=source.array,sourceStride=source.stride;if(void 0!==primitive.vcount)for(var index=0,i=0,l=vcount.length;i<l;i++){var count=vcount[i];if(4===count){var b=index+1*stride,c=index+2*stride,d=index+3*stride;pushVector(index+0*stride),pushVector(b),pushVector(d),pushVector(b),pushVector(c),pushVector(d)}else if(3===count){b=index+1*stride,c=index+2*stride;pushVector(index+0*stride),pushVector(b),pushVector(c)}else if(count>4)for(var k=1,kl=count-2;k<=kl;k++){b=index+stride*k,c=index+stride*(k+1);pushVector(index+0*stride),pushVector(b),pushVector(c)}index+=stride*count}else for(i=0,l=indices.length;i<l;i+=stride)pushVector(i)}function getGeometry(id){return getBuild(library.geometries[id],buildGeometry)}function buildKinematicsModel(data){return void 0!==data.build?data.build:data}function parseKinematicsTechniqueCommon(xml,data){for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"joint":data.joints[child.getAttribute("sid")]=parseKinematicsJoint(child);break;case"link":data.links.push(parseKinematicsLink(child))}}}function parseKinematicsJoint(xml){for(var data,i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"prismatic":case"revolute":data=parseKinematicsJointParameter(child)}}return data}function parseKinematicsJointParameter(xml,data){data={sid:xml.getAttribute("sid"),name:xml.getAttribute("name")||"",axis:new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3,limits:{min:0,max:0},type:xml.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"axis":var array=parseFloats(child.textContent);data.axis.fromArray(array);break;case"limits":var max=child.getElementsByTagName("max")[0],min=child.getElementsByTagName("min")[0];data.limits.max=parseFloat(max.textContent),data.limits.min=parseFloat(min.textContent)}}return data.limits.min>=data.limits.max&&(data.static=!0),data.middlePosition=(data.limits.min+data.limits.max)/2,data}function parseKinematicsLink(xml){for(var data={sid:xml.getAttribute("sid"),name:xml.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"attachment_full":data.attachments.push(parseKinematicsAttachment(child));break;case"matrix":case"translate":case"rotate":data.transforms.push(parseKinematicsTransform(child))}}return data}function parseKinematicsAttachment(xml){for(var data={joint:xml.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"link":data.links.push(parseKinematicsLink(child));break;case"matrix":case"translate":case"rotate":data.transforms.push(parseKinematicsTransform(child))}}return data}function parseKinematicsTransform(xml){var data={type:xml.nodeName},array=parseFloats(xml.textContent);switch(data.type){case"matrix":data.obj=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4,data.obj.fromArray(array).transpose();break;case"translate":data.obj=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3,data.obj.fromArray(array);break;case"rotate":data.obj=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3,data.obj.fromArray(array),data.angle=_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Math.degToRad(array[3])}return data}function parsePhysicsRigidBody(xml,data){for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"technique_common":parsePhysicsTechniqueCommon(child,data)}}}function parsePhysicsTechniqueCommon(xml,data){for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"inertia":data.inertia=parseFloats(child.textContent);break;case"mass":data.mass=parseFloats(child.textContent)[0]}}}function parseKinematicsBindJointAxis(xml){for(var data={target:xml.getAttribute("target").split("/").pop()},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"axis":var param=child.getElementsByTagName("param")[0];data.axis=param.textContent;var tmpJointIndex=data.axis.split("inst_").pop().split("axis")[0];data.jointIndex=tmpJointIndex.substr(0,tmpJointIndex.length-1)}}return data}function buildKinematicsScene(data){return void 0!==data.build?data.build:data}function buildTransformList(node){for(var transforms=[],xml=collada.querySelector('[id="'+node.id+'"]'),i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"matrix":var array=parseFloats(child.textContent),matrix=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4).fromArray(array).transpose();transforms.push({sid:child.getAttribute("sid"),type:child.nodeName,obj:matrix});break;case"translate":case"scale":array=parseFloats(child.textContent);var vector=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3).fromArray(array);transforms.push({sid:child.getAttribute("sid"),type:child.nodeName,obj:vector});break;case"rotate":array=parseFloats(child.textContent),vector=(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3).fromArray(array);var angle=_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Math.degToRad(array[3]);transforms.push({sid:child.getAttribute("sid"),type:child.nodeName,obj:vector,angle:angle})}}return transforms}var matrix=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4,vector=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Vector3;function parseNode(xml){for(var data={name:xml.getAttribute("name")||"",type:xml.getAttribute("type"),id:xml.getAttribute("id"),sid:xml.getAttribute("sid"),matrix:new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"node":data.nodes.push(child.getAttribute("id")),parseNode(child);break;case"instance_camera":data.instanceCameras.push(parseId(child.getAttribute("url")));break;case"instance_controller":data.instanceControllers.push(parseNodeInstance(child));break;case"instance_light":data.instanceLights.push(parseId(child.getAttribute("url")));break;case"instance_geometry":data.instanceGeometries.push(parseNodeInstance(child));break;case"instance_node":data.instanceNodes.push(parseId(child.getAttribute("url")));break;case"matrix":var array=parseFloats(child.textContent);data.matrix.multiply(matrix.fromArray(array).transpose()),data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"translate":array=parseFloats(child.textContent);vector.fromArray(array),data.matrix.multiply(matrix.makeTranslation(vector.x,vector.y,vector.z)),data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"rotate":array=parseFloats(child.textContent);var angle=_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Math.degToRad(array[3]);data.matrix.multiply(matrix.makeRotationAxis(vector.fromArray(array),angle)),data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"scale":array=parseFloats(child.textContent);data.matrix.scale(vector.fromArray(array)),data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"extra":break;default:console.log(child)}}return hasNode(data.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",data.id):library.nodes[data.id]=data,data}function parseNodeInstance(xml){for(var data={id:parseId(xml.getAttribute("url")),materials:{},skeletons:[]},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];switch(child.nodeName){case"bind_material":for(var instances=child.getElementsByTagName("instance_material"),j=0;j<instances.length;j++){var instance=instances[j],symbol=instance.getAttribute("symbol"),target=instance.getAttribute("target");data.materials[symbol]=parseId(target)}break;case"skeleton":data.skeletons.push(parseId(child.textContent))}}return data}function buildSkeleton(skeletons,joints){var i,data,id,boneData=[],sortedBoneData=[];for(i=0;i<skeletons.length;i++){var skeleton=skeletons[i];if(hasNode(skeleton))buildBoneHierarchy(getNode(skeleton),joints,boneData);else if(id=skeleton,void 0!==library.visualScenes[id])for(var children=library.visualScenes[skeleton].children,j=0;j<children.length;j++){var child=children[j];if("JOINT"===child.type)buildBoneHierarchy(getNode(child.id),joints,boneData)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",skeleton)}for(i=0;i<joints.length;i++)for(j=0;j<boneData.length;j++)if((data=boneData[j]).bone.name===joints[i].name){sortedBoneData[i]=data,data.processed=!0;break}for(i=0;i<boneData.length;i++)!1===(data=boneData[i]).processed&&(sortedBoneData.push(data),data.processed=!0);var bones=[],boneInverses=[];for(i=0;i<sortedBoneData.length;i++)data=sortedBoneData[i],bones.push(data.bone),boneInverses.push(data.boneInverse);return new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Skeleton(bones,boneInverses)}function buildBoneHierarchy(root,joints,boneData){root.traverse((function(object){if(!0===object.isBone){for(var boneInverse,i=0;i<joints.length;i++){var joint=joints[i];if(joint.name===object.name){boneInverse=joint.boneInverse;break}}void 0===boneInverse&&(boneInverse=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4),boneData.push({bone:object,boneInverse:boneInverse,processed:!1})}}))}function buildNode(data){for(var id,objects=[],matrix=data.matrix,nodes=data.nodes,type=data.type,instanceCameras=data.instanceCameras,instanceControllers=data.instanceControllers,instanceLights=data.instanceLights,instanceGeometries=data.instanceGeometries,instanceNodes=data.instanceNodes,i=0,l=nodes.length;i<l;i++)objects.push(getNode(nodes[i]));for(i=0,l=instanceCameras.length;i<l;i++){var instanceCamera=getCamera(instanceCameras[i]);null!==instanceCamera&&objects.push(instanceCamera.clone())}for(i=0,l=instanceControllers.length;i<l;i++)for(var instance=instanceControllers[i],controller=(id=instance.id,getBuild(library.controllers[id],buildController)),newObjects=buildObjects(getGeometry(controller.id),instance.materials),skeleton=buildSkeleton(instance.skeletons,controller.skin.joints),j=0,jl=newObjects.length;j<jl;j++){var object;(object=newObjects[j]).isSkinnedMesh&&(object.bind(skeleton,controller.skin.bindMatrix),object.normalizeSkinWeights()),objects.push(object)}for(i=0,l=instanceLights.length;i<l;i++){var instanceLight=getLight(instanceLights[i]);null!==instanceLight&&objects.push(instanceLight.clone())}for(i=0,l=instanceGeometries.length;i<l;i++)for(j=0,jl=(newObjects=buildObjects(getGeometry((instance=instanceGeometries[i]).id),instance.materials)).length;j<jl;j++)objects.push(newObjects[j]);for(i=0,l=instanceNodes.length;i<l;i++)objects.push(getNode(instanceNodes[i]).clone());if(0===nodes.length&&1===objects.length)object=objects[0];else{object="JOINT"===type?new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Bone:new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Group;for(i=0;i<objects.length;i++)object.add(objects[i])}return""===object.name&&(object.name="JOINT"===type?data.sid:data.name),object.matrix.copy(matrix),object.matrix.decompose(object.position,object.quaternion,object.scale),object}var fallbackMaterial=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.MeshBasicMaterial({color:16711935});function resolveMaterialBinding(keys,instanceMaterials){for(var materials=[],i=0,l=keys.length;i<l;i++){var id=instanceMaterials[keys[i]];void 0===id?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",keys[i]),materials.push(fallbackMaterial)):materials.push(getMaterial(id))}return materials}function buildObjects(geometries,instanceMaterials){var objects=[];for(var type in geometries){var geometry=geometries[type],materials=resolveMaterialBinding(geometry.materialKeys,instanceMaterials);0===materials.length&&("lines"===type||"linestrips"===type?materials.push(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.LineBasicMaterial):materials.push(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.MeshPhongMaterial));var skinning=void 0!==geometry.data.attributes.skinIndex;if(skinning)for(var i=0,l=materials.length;i<l;i++)materials[i].skinning=!0;var object,material=1===materials.length?materials[0]:materials;switch(type){case"lines":object=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.LineSegments(geometry.data,material);break;case"linestrips":object=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Line(geometry.data,material);break;case"triangles":case"polylist":object=skinning?new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.SkinnedMesh(geometry.data,material):new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Mesh(geometry.data,material)}objects.push(object)}return objects}function hasNode(id){return void 0!==library.nodes[id]}function getNode(id){return getBuild(library.nodes[id],buildNode)}function buildVisualScene(data){var group=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Group;group.name=data.name;for(var children=data.children,i=0;i<children.length;i++){var child=children[i];group.add(getNode(child.id))}return group}function getVisualScene(id){return getBuild(library.visualScenes[id],buildVisualScene)}if(0===text.length)return{scene:new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Scene};var xml=(new DOMParser).parseFromString(text,"application/xml"),collada=getElementsByTagName(xml,"COLLADA")[0],parserError=xml.getElementsByTagName("parsererror")[0];if(void 0!==parserError){var errorText,errorElement=getElementsByTagName(parserError,"div")[0];return errorText=errorElement?errorElement.textContent:function parserErrorToText(parserError){for(var result="",stack=[parserError];stack.length;){var node=stack.shift();node.nodeType===Node.TEXT_NODE?result+=node.textContent:(result+="\n",stack.push.apply(stack,node.childNodes))}return result.trim()}(parserError),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",errorText),null}var version=collada.getAttribute("version");console.log("THREE.ColladaLoader: File version",version);var tgaLoader,asset=function parseAsset(xml){return{unit:parseAssetUnit(getElementsByTagName(xml,"unit")[0]),upAxis:parseAssetUpAxis(getElementsByTagName(xml,"up_axis")[0])}}(getElementsByTagName(collada,"asset")[0]),textureLoader=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.TextureLoader(this.manager);textureLoader.setPath(this.resourcePath||path).setCrossOrigin(this.crossOrigin),_loaders_TGALoader_js__WEBPACK_IMPORTED_MODULE_1__.a&&(tgaLoader=new _loaders_TGALoader_js__WEBPACK_IMPORTED_MODULE_1__.a(this.manager)).setPath(this.resourcePath||path);var animations=[],kinematics={},count=0,library={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};parseLibrary(collada,"library_animations","animation",(function parseAnimation(xml){for(var data={sources:{},samplers:{},channels:{}},i=0,l=xml.childNodes.length;i<l;i++){var id,child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"source":id=child.getAttribute("id"),data.sources[id]=parseSource(child);break;case"sampler":id=child.getAttribute("id"),data.samplers[id]=parseAnimationSampler(child);break;case"channel":id=child.getAttribute("target"),data.channels[id]=parseAnimationChannel(child);break;default:console.log(child)}}library.animations[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_animation_clips","animation_clip",(function parseAnimationClip(xml){for(var data={name:xml.getAttribute("id")||"default",start:parseFloat(xml.getAttribute("start")||0),end:parseFloat(xml.getAttribute("end")||0),animations:[]},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"instance_animation":data.animations.push(parseId(child.getAttribute("url")))}}library.clips[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_controllers","controller",(function parseController(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"skin":data.id=parseId(child.getAttribute("source")),data.skin=parseSkin(child);break;case"morph":data.id=parseId(child.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}library.controllers[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_images","image",(function parseImage(xml){var data={init_from:getElementsByTagName(xml,"init_from")[0].textContent};library.images[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_effects","effect",(function parseEffect(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"profile_COMMON":data.profile=parseEffectProfileCOMMON(child)}}library.effects[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_materials","material",(function parseMaterial(xml){for(var data={name:xml.getAttribute("name")},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"instance_effect":data.url=parseId(child.getAttribute("url"))}}library.materials[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_cameras","camera",(function parseCamera(xml){for(var data={name:xml.getAttribute("name")},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"optics":data.optics=parseCameraOptics(child)}}library.cameras[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_lights","light",(function parseLight(xml){for(var data={},i=0,l=xml.childNodes.length;i<l;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"technique_common":data=parseLightTechnique(child)}}library.lights[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_geometries","geometry",(function parseGeometry(xml){var data={name:xml.getAttribute("name"),sources:{},vertices:{},primitives:[]},mesh=getElementsByTagName(xml,"mesh")[0];if(void 0!==mesh){for(var i=0;i<mesh.childNodes.length;i++){var child=mesh.childNodes[i];if(1===child.nodeType){var id=child.getAttribute("id");switch(child.nodeName){case"source":data.sources[id]=parseSource(child);break;case"vertices":data.vertices=parseGeometryVertices(child);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",child.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":data.primitives.push(parseGeometryPrimitive(child));break;default:console.log(child)}}}library.geometries[xml.getAttribute("id")]=data}})),parseLibrary(collada,"library_nodes","node",parseNode),parseLibrary(collada,"library_visual_scenes","visual_scene",(function parseVisualScene(xml){var data={name:xml.getAttribute("name"),children:[]};!function prepareNodes(xml){for(var elements=xml.getElementsByTagName("node"),i=0;i<elements.length;i++){var element=elements[i];!1===element.hasAttribute("id")&&element.setAttribute("id","three_default_"+count++)}}(xml);for(var elements=getElementsByTagName(xml,"node"),i=0;i<elements.length;i++)data.children.push(parseNode(elements[i]));library.visualScenes[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_kinematics_models","kinematics_model",(function parseKinematicsModel(xml){for(var data={name:xml.getAttribute("name")||"",joints:{},links:[]},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"technique_common":parseKinematicsTechniqueCommon(child,data)}}library.kinematicsModels[xml.getAttribute("id")]=data})),parseLibrary(collada,"library_physics_models","physics_model",(function parsePhysicsModel(xml){for(var data={name:xml.getAttribute("name")||"",rigidBodies:{}},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"rigid_body":data.rigidBodies[child.getAttribute("name")]={},parsePhysicsRigidBody(child,data.rigidBodies[child.getAttribute("name")])}}library.physicsModels[xml.getAttribute("id")]=data})),parseLibrary(collada,"scene","instance_kinematics_scene",(function parseKinematicsScene(xml){for(var data={bindJointAxis:[]},i=0;i<xml.childNodes.length;i++){var child=xml.childNodes[i];if(1===child.nodeType)switch(child.nodeName){case"bind_joint_axis":data.bindJointAxis.push(parseKinematicsBindJointAxis(child))}}library.kinematicsScenes[parseId(xml.getAttribute("url"))]=data})),buildLibrary(library.animations,buildAnimation),buildLibrary(library.clips,buildAnimationClip),buildLibrary(library.controllers,buildController),buildLibrary(library.images,buildImage),buildLibrary(library.effects,buildEffect),buildLibrary(library.materials,buildMaterial),buildLibrary(library.cameras,buildCamera),buildLibrary(library.lights,buildLight),buildLibrary(library.geometries,buildGeometry),buildLibrary(library.visualScenes,buildVisualScene),function setupAnimations(){var clips=library.clips;if(!0===isEmpty(clips)){if(!1===isEmpty(library.animations)){var tracks=[];for(var id in library.animations)for(var animationTracks=getAnimation(id),i=0,l=animationTracks.length;i<l;i++)tracks.push(animationTracks[i]);animations.push(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.AnimationClip("default",-1,tracks))}}else for(var id in clips)animations.push(getAnimationClip(id))}(),function setupKinematics(){var kinematicsModelId=Object.keys(library.kinematicsModels)[0],kinematicsSceneId=Object.keys(library.kinematicsScenes)[0],visualSceneId=Object.keys(library.visualScenes)[0];if(void 0!==kinematicsModelId&&void 0!==kinematicsSceneId){for(var kinematicsModel=function getKinematicsModel(id){return getBuild(library.kinematicsModels[id],buildKinematicsModel)}(kinematicsModelId),kinematicsScene=function getKinematicsScene(id){return getBuild(library.kinematicsScenes[id],buildKinematicsScene)}(kinematicsSceneId),visualScene=getVisualScene(visualSceneId),bindJointAxis=kinematicsScene.bindJointAxis,jointMap={},i=0,l=bindJointAxis.length;i<l;i++){var axis=bindJointAxis[i],targetElement=collada.querySelector('[sid="'+axis.target+'"]');if(targetElement){var parentVisualElement=targetElement.parentElement;connect(axis.jointIndex,parentVisualElement)}}var m0=new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4;kinematics={joints:kinematicsModel&&kinematicsModel.joints,getJointValue:function(jointIndex){var jointData=jointMap[jointIndex];if(jointData)return jointData.position;console.warn("THREE.ColladaLoader: Joint "+jointIndex+" doesn't exist.")},setJointValue:function(jointIndex,value){var jointData=jointMap[jointIndex];if(jointData){var joint=jointData.joint;if(value>joint.limits.max||value<joint.limits.min)console.warn("THREE.ColladaLoader: Joint "+jointIndex+" value "+value+" outside of limits (min: "+joint.limits.min+", max: "+joint.limits.max+").");else if(joint.static)console.warn("THREE.ColladaLoader: Joint "+jointIndex+" is static.");else{var object=jointData.object,axis=joint.axis,transforms=jointData.transforms;matrix.identity();for(var i=0;i<transforms.length;i++){var transform=transforms[i];if(transform.sid&&-1!==transform.sid.indexOf(jointIndex))switch(joint.type){case"revolute":matrix.multiply(m0.makeRotationAxis(axis,_build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Math.degToRad(value)));break;case"prismatic":matrix.multiply(m0.makeTranslation(axis.x*value,axis.y*value,axis.z*value));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+joint.type)}else switch(transform.type){case"matrix":matrix.multiply(transform.obj);break;case"translate":matrix.multiply(m0.makeTranslation(transform.obj.x,transform.obj.y,transform.obj.z));break;case"scale":matrix.scale(transform.obj);break;case"rotate":matrix.multiply(m0.makeRotationAxis(transform.obj,transform.angle))}}object.matrix.copy(matrix),object.matrix.decompose(object.position,object.quaternion,object.scale),jointMap[jointIndex].position=value}}else console.log("THREE.ColladaLoader: "+jointIndex+" does not exist.")}}}function connect(jointIndex,visualElement){var visualElementName=visualElement.getAttribute("name"),joint=kinematicsModel.joints[jointIndex];visualScene.traverse((function(object){object.name===visualElementName&&(jointMap[jointIndex]={object:object,transforms:buildTransformList(visualElement),joint:joint,position:joint.zeroPosition})}))}}();var scene=function parseScene(xml){return getVisualScene(parseId(getElementsByTagName(xml,"instance_visual_scene")[0].getAttribute("url")))}(getElementsByTagName(collada,"scene")[0]);return"Z_UP"===asset.upAxis&&scene.quaternion.setFromEuler(new _build_three_module_js__WEBPACK_IMPORTED_MODULE_0__.Euler(-Math.PI/2,0,0)),scene.scale.multiplyScalar(asset.unit),{animations:animations,kinematics:kinematics,library:library,scene:scene}}}}}]);
//# sourceMappingURL=21.3cc1079fb8472c44bc5a.bundle.js.map