{"version":3,"file":"12.fc18eed1a7989718187a.bundle.js","sources":["webpack:///./src/chapter2/3.ts"],"sourcesContent":["import * as THREE from 'three';\r\nimport * as Stats from 'stats.js';\r\nimport * as dat from 'dat.gui';\r\nimport createMultiMaterialObject from '../utils/createMultiMaterialObject';\r\n\r\nexport default () => {\r\n  // 画面サイズ\r\n  const VIEWPORT_W = window.innerWidth;\r\n  const VIEWPORT_H = window.innerHeight;\r\n\r\n  /* scene */\r\n  const scene = new THREE.Scene();\r\n\r\n  /* camera */\r\n  const camera = new THREE.PerspectiveCamera(\r\n    45,\r\n    VIEWPORT_W / VIEWPORT_H,\r\n    0.1,\r\n    1000\r\n  );\r\n  scene.add(camera);\r\n  camera.position.x = -20;\r\n  camera.position.y = 25;\r\n  camera.position.z = 20;\r\n  camera.lookAt(new THREE.Vector3(5, 0, 0));\r\n\r\n  /* renderer */\r\n  const renderer = new THREE.WebGLRenderer();\r\n  renderer.setClearColor(new THREE.Color(0xeeeeee));\r\n  renderer.setSize(VIEWPORT_W, VIEWPORT_H);\r\n  renderer.shadowMap.enabled = true;\r\n\r\n  /* plane */\r\n  const planeGeometry = new THREE.PlaneGeometry(60, 40, 1, 1);\r\n  const planeMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });\r\n  const plane = new THREE.Mesh(planeGeometry, planeMaterial);\r\n  plane.receiveShadow = true;\r\n  plane.rotation.x = -0.5 * Math.PI;\r\n  plane.position.x = 0;\r\n  plane.position.y = 0;\r\n  plane.position.z = 0;\r\n  scene.add(plane);\r\n\r\n  /* ambientLight */\r\n  const ambientLight = new THREE.AmbientLight(0x090909);\r\n  scene.add(ambientLight);\r\n\r\n  /* spotLight */\r\n  const spotLight = new THREE.SpotLight(0xffffff);\r\n  spotLight.position.set(-20, 30, 5);\r\n  spotLight.castShadow = true;\r\n  scene.add(spotLight);\r\n\r\n  const geom = new THREE.Geometry();\r\n  geom.vertices = [\r\n    new THREE.Vector3(1, 3, 1),\r\n    new THREE.Vector3(1, 3, -1),\r\n    new THREE.Vector3(1, -1, 1),\r\n    new THREE.Vector3(1, -1, -1),\r\n    new THREE.Vector3(-1, 3, -1),\r\n    new THREE.Vector3(-1, 3, 1),\r\n    new THREE.Vector3(-1, -1, -1),\r\n    new THREE.Vector3(-1, -1, 1)\r\n  ];\r\n  geom.faces = [\r\n    new THREE.Face3(0, 2, 1),\r\n    new THREE.Face3(2, 3, 1),\r\n    new THREE.Face3(4, 6, 5),\r\n    new THREE.Face3(6, 7, 5),\r\n    new THREE.Face3(4, 5, 1),\r\n    new THREE.Face3(5, 0, 1),\r\n    new THREE.Face3(7, 6, 2),\r\n    new THREE.Face3(6, 3, 2),\r\n    new THREE.Face3(5, 7, 0),\r\n    new THREE.Face3(7, 2, 0),\r\n    new THREE.Face3(1, 3, 4),\r\n    new THREE.Face3(3, 6, 4)\r\n  ];\r\n  geom.computeFaceNormals();\r\n\r\n  const materials = [\r\n    new THREE.MeshLambertMaterial({\r\n      opacity: 0.6,\r\n      color: 0x44ff44,\r\n      transparent: true\r\n    }),\r\n    new THREE.MeshBasicMaterial({ color: 0x000000, wireframe: true })\r\n  ];\r\n\r\n  const mesh = createMultiMaterialObject(geom, materials);\r\n  mesh.children.forEach(e => {\r\n    e.castShadow = true;\r\n  });\r\n\r\n  scene.add(mesh);\r\n\r\n  const addControl = (x: number, y: number, z: number) => ({\r\n    x,\r\n    y,\r\n    z\r\n  });\r\n\r\n  const controlPoints = [];\r\n  controlPoints.push(addControl(3, 5, 3));\r\n  controlPoints.push(addControl(3, 5, 0));\r\n  controlPoints.push(addControl(3, 0, 3));\r\n  controlPoints.push(addControl(3, 0, 0));\r\n  controlPoints.push(addControl(0, 5, 0));\r\n  controlPoints.push(addControl(0, 5, 3));\r\n  controlPoints.push(addControl(0, 0, 0));\r\n  controlPoints.push(addControl(0, 0, 3));\r\n\r\n  const gui = new dat.GUI();\r\n  gui.add(\r\n    {\r\n      clone: () => {\r\n        const clonedGeometry = (mesh\r\n          .children[0] as THREE.Mesh).geometry.clone();\r\n        const materials = [\r\n          new THREE.MeshLambertMaterial({\r\n            opacity: 0.6,\r\n            color: 0xff44ff,\r\n            transparent: true\r\n          }),\r\n          new THREE.MeshBasicMaterial({ color: 0x000000, wireframe: true })\r\n        ];\r\n        const mesh2 = createMultiMaterialObject(clonedGeometry, materials);\r\n        mesh2.children.forEach(e => {\r\n          e.castShadow = true;\r\n        });\r\n        mesh2.translateX(5);\r\n        mesh2.translateZ(5);\r\n        mesh2.name = 'clone';\r\n        scene.remove(scene.getObjectByName('clone'));\r\n        scene.add(mesh2);\r\n      }\r\n    },\r\n    'clone'\r\n  );\r\n\r\n  for (var i = 0; i < 8; i++) {\r\n    const f1 = gui.addFolder('Vertices ' + (i + 1));\r\n    f1.add(controlPoints[i], 'x', -10, 10);\r\n    f1.add(controlPoints[i], 'y', -10, 10);\r\n    f1.add(controlPoints[i], 'z', -10, 10);\r\n  }\r\n\r\n  document.getElementById('WebGL-output').appendChild(renderer.domElement);\r\n\r\n  /* stats */\r\n  const stats = (() => {\r\n    const statsObj = new Stats();\r\n    statsObj.showPanel(0);\r\n    statsObj.dom.style.position = 'absolute';\r\n    statsObj.dom.style.left = '0px';\r\n    statsObj.dom.style.top = '0px';\r\n\r\n    document.getElementById('Stats-output').appendChild(statsObj.dom);\r\n\r\n    return statsObj;\r\n  })();\r\n\r\n  /* render */\r\n  const render = () => {\r\n    stats.update();\r\n    mesh.children.forEach(e => {\r\n      for (var i = 0; i < 8; i++) {\r\n        ((e as THREE.Mesh).geometry as THREE.Geometry).vertices[i].set(\r\n          controlPoints[i].x,\r\n          controlPoints[i].y,\r\n          controlPoints[i].z\r\n        );\r\n      }\r\n      ((e as THREE.Mesh).geometry as THREE.Geometry).verticesNeedUpdate = true;\r\n      ((e as THREE.Mesh).geometry as THREE.Geometry).computeFaceNormals();\r\n    });\r\n    requestAnimationFrame(render);\r\n    renderer.render(scene, camera);\r\n  };\r\n  render();\r\n};\r\n"],"mappings":"AAAA","sourceRoot":""}